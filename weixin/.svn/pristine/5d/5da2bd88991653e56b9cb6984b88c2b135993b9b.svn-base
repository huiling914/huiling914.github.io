// pages/school/details/course/course.js
const app = getApp()
const util = require('../../../../utils/util.js')
const getUrl = '/mall//admin/class/list'
Page({

  /**
   * 页面的初始数据
   */
  data: {
    schoolName: '',
    courseName: '',
    picUrl: '',
    originalPrice: '',
    discountPrice: '',
    teachers: '',
    times: '', //课次,
    classTime: '2019/03/09-2019/05/04 每周六8：20-10：20',
    address: '金银路八一路交叉口北150米路西',
    description: '',
    maxStudent: '',
    lat: '',
    lng: ''
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function(options) {
    const that = this
    let courseId = options.courseId,
      schoolId = options.schoolId
    that.setData({
      courseId: courseId,
      schoolId: schoolId,
      isIphone5: app.globalData.isIphone5,
      lng: options.lng,
      lat: options.lat
    })
    app.wxRequest(getUrl, {
      id: courseId
    }, 'get').then(res => {
      if (res.statusCode == 200) {
        if (res.data.errno == 0) {
          let course = res.data.data.items[0]
          let schoolName = course.schoolName,
            courseName = course.name,
            picUrl = util.jointUrl(course.pictureUrl),
            teacherList = '',
            originalPrice = course.counterPrice,
            discountPrice = course.retailPrice,
            times = course.times,
            description = course.description,
            maxStudent = course.maxStudent,
            address = course.address,
            phone = course.phone
          wx.setNavigationBarTitle({
            title: schoolName
          })
          if (course.litemallTeacherList.length == 0) {
            teacherList = '待定'
          } else {
            let teacher = ''
            for (var j = 0; j < course.litemallTeacherList.length; j++) {
              teacher = ''
              teacher = course.litemallTeacherList[j].name
              teacherList += teacher + '、'
            }
            teacherList = teacherList.substring(0, teacherList.length - 1)
          }
          that.setData({
            schoolName: schoolName,
            courseName: courseName,
            picUrl: picUrl,
            teacher: teacherList,
            originalPrice: originalPrice,
            discountPrice: discountPrice,
            times: times,
            description: description,
            maxStudent: maxStudent,
            address: address,
            phone: phone
          })
          wx.setNavigationBarTitle({
            title: schoolName
          })
        } else {
          util.errorTip('获取失败')
          console.log(res.data.errmsg)
        }
      } else {
        util.errorTip('请求失败')
        console.log(res.errmsg)
      }
    })
  },

  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function() {

  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function() {

  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide: function() {

  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload: function() {

  },
  //打电话
  goToAddress: function() {
    if (this.data.lat != '') {
      wx.openLocation({
        latitude: parseFloat(this.data.lat),
        longitude: parseFloat(this.data.lng),
        success: function(res) {
          console.log('res', res)
        }
      })
    }
  },
  signUp: function() {
    wx.navigateTo({
      url: '/pages/createOrder/create?orderType=1&brandId=' + this.data.schoolId + '&goodsPrice=' + this.data.discountPrice
    })
  },
  back: util.back,
  onShareAppMessage: function () {
    let that = this;
    return {
      title: '乐宝教育365', // 转发后 所显示的title
      path: '/pages/loading/loading'
    }
  }
})